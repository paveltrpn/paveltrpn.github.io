<!DOCTYPE html>
<html>
  <head>
    <title>Administration tips</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/prism.css" />
  </head>
  <body>
    <!-- Подключение скрипта Prism -->
    <script src="js/prism.js"></script>

    <!-- ============= НАЧАЛО ЗАПИСИ ============= -->
    <div class="post">
      <p>
        <b>Установка ядра 5.8 под Linux Mint 20</b>
      </p>
    
      <p>
        Ядро по умолчанию в Mint 20 - 5.4. Ядро 5.8 понадобилось, чтобы в VMWare
        Player 16 заработал OpenGL 4.1. Установка ядра 5.8 без сборки из *.deb
        пакетов очень проста. Скачиваем:
      </p>

      <p style="text-align: left">
        &emsp;&emsp; -
        https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.8/amd64/linux-headers-5.8.0-050800-generic_5.8.0-050800.202008022230_amd64.deb<br />
        &emsp;&emsp; -
        https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.8/amd64/linux-image-unsigned-5.8.0-050800-generic_5.8.0-050800.202008022230_amd64.deb<br />
        &emsp;&emsp; -
        https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.8/amd64/linux-modules-5.8.0-050800-generic_5.8.0-050800.202008022230_amd64.deb
      </p>

      <p>
        Нужно убедиться что в папке нет других *.deb пакетов. Далее просто
        запускаем:
      </p>

      <pre><code class="language-bash">sudo dpkg -i *.deb</code></pre>

      <p>После перезагрузки ваполним:</p>

      <pre><code class="language-bash">uname -a</code></pre>
    </div>

    <div class="post">
      <p>
        <b>Cборка Mesa3d 20.2</b>
      </p>

      <p>Скачиваем и паспаковываем дистрибутив с сайта Mesa 3d:</p>

      <p>&emsp;&emsp; - https://docs.mesa3d.org/download.html</p>

      <p>
        Вообще, сборка описана там же на сайте. Собираем по инструкции
        https://docs.mesa3d.org/install.html. Если в кратце, то:
      </p>

      <pre><code class="language-bash">meson builddir/
ninja -C builddir/
sudo ninja -C builddir/ install</code></pre>

      <p>
        Там будет много зависимостей от X11, устанавливаем все, конфигурирум и
        собираем через Meson и Ninja. После сборки Ninja закинет собраные
        бинарники в - `/usr/local/lib/x86_64-linux-gnu`, перемещаем всё это
        добро в `/usr/lib/x86_64-linux-gnu`.
      </p>
    </div>

      <!-- ============= НАЧАЛО ЗАПИСИ ============= -->

    <div class="post">
      <p>
        <b>Command line tips</b>
      </p>

      <pre><code class="language-bash"># pockets, that must be installed on clear system (deb)
sudo apt-get install git mc exa tree g++ cmake pkg-config translate-shell batcat

# common development libraries and sdk's
sudo apt-get install libmesa-dev

# .bashrc file tweak for support frequently used commands
alias ll='exa -l'
alias la='ls -A'
alias l='ls -CF'
alias tt='tree'
# translate-shell aliases for russian to english and opposite translations
alias tru='trans :ru'
alias ten='trans :en'
alias bat='batcat'

# locate the binary, source, and manual page files for a command
whereis {command}
    
# locate a command
which {command}

# fency ls alternative
# sudo apt-get install exa
exa

# fency cat alternative
# sudo apt-get install bat
batcat</code></pre>
    </div>
    <!-- ============= КОНЕЦ ЗАПИСИ ============== -->

    <div class="post">
      <!-- ============= НАЧАЛО ЗАПИСИ ============= -->

      <p>
        <b>Работа с пакетами в Ubuntu</b>
      </p>

      <pre><code class="language-bash"># Вывести список установленных пакетов (и отфильтровать по имени)
sudo apt list --installed | grep {package-name}
# или
dpkg-query -l {package-name}

# Вывести список пакетов к которым доступны обновления (И посчитать сколько их)
apt list --upgradable | wc -l

# добавить репозиторий
sudo add-apt-repository ppa:{repo-name}/ppa

# удалить репозиторий
sudo add-apt-repository --remove ppa:{repo-name}/ppa

# и потом не забыть сделать
sudo apt update

# установить из *.deb пакета (на примере vs code)
apt-get install -f ./code_1.39.2-1571154070_amd64.deb

# Обновить один конкртный пакет
sudo apt-get install --only-upgrade {package-name}</code></pre>

      <p><b>Принудительно включаем X.Org</b> вместо Wayland в Ubuntu</p>

      <pre><code class="language-bash">sudo xed /etc/gdm3/custom.conf
# и там раскомментируем строку
# WaylandEnable=false</code></pre>
</div>
    <!-- ============= КОНЕЦ ЗАПИСИ ============== -->

    <div class="post">
      <!-- ============= НАЧАЛО ЗАПИСИ ============= -->

      <p>
        <b>Собираем xed под Ubuntu 21.10</b>, полезная замена gedit, почему то
        не включённая в дистрибутив по умолчанию
      </p>

      <p>Скачиваем:</p>

      <pre>
    <code class="language-bash">git clone https://github.com/linuxmint/xed</code></pre>

      <p>Устанавливаем зависимости:</p>

      <pre><code class="language-bash">sudo apt-get install meson
sudo apt-get install libxml2*dev
sudo apt-get install libglib2*dev
sudo apt-get install build-essential libgtk-3-dev
sudo apt-get install gir1.2-gtksource
sudo apt-get install libgtksourceview-4-dev
sudo apt-get install libpeas*dev
sudo apt-get install libxapp*dev
sudo apt-get install libgspell-1*dev
sudo apt-get install intltool
sudo apt-get install itstool</code></pre>

      <p>Компилируем, собираем и устанавливаем:</p>

      <pre><code class="language-bash">ninja -v -C build
sudo ninja install -v -C build
// Это нужно чтобы избежать рантайм ошибки
sudo /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas/</code></pre>
    </div>
    <!-- ============= КОНЕЦ ЗАПИСИ ============== -->

    <div class="post">
      <!-- ============= НАЧАЛО ЗАПИСИ ============= -->
      <p>
        <b>Сборка и установка gcc из исходников под Ubuntu</b>
      </p>

      <p>
        Это - коротка статья о компиляции GCC 10.1 из исходных кодов под Ubuntu
        20.04 x64. По умолчанию Ubuntu 20.04 имеет GCC версии 9.3, которя не
        плоха, однако версия 10 имеет законченную поддержку стандартов C++11,
        C++14, C++17 и частичную поддержку стандарта C++20. GCC 10 поддерживает
        C11 и C++14 по умолчанию, больше нет необходимости использовать ключи
        -std=c11 или -std=c++14.<br />
        <br />
        Для начала, давайте убедимся, что у нас установлены все обновления:
      </p>

      <pre><code class="language-shell">$ sudo apt update
$ sudo apt upgrade</code></pre>

      <p>
        Теперь, установим тулчейн GCC и несколко дополнительных утилит вместе с
        ним:
      </p>

      <pre>
    <code class="language-shell">$ sudo apt install build-essential wget m4 flex bison</code></pre>

      <p>
        Далее, загрузим исходный код GCC 10 и пререквизиты (prerequisites) с
        сайта http://gcc.gnu.org/mirrors.html:
      </p>

      <pre><code class="language-shell">$ cd ~
$ wget https://ftpmirror.gnu.org/gcc/gcc-10.1.0/gcc-10.1.0.tar.xz
$ tar xf gcc-10.1.0.tar.xz
$ cd gcc-10.1.0
# execute at top level of gcc directory
$ ./contrib/download_prerequisites</code></pre>

      <p>
        Теперь мы можем сконфигурировать и собрать исходный код. Чтобы сохранить
        систему чистой, будем использовать папку /usr/local/gcc-10.1.0 для
        установки и добавим суффикс -10.1 к компиляторам GCC из данного пакета.
        Обычно, мы не хотим смешивать установленный по умолчанию GCC с новой
        версией, потому что другие пакеты могут зависеть от него.
      </p>

      <pre><code class="language-shell">$ cd ~
$ mkdir build && cd build
$ ../configure -v --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu 
 --prefix=/usr/local/gcc-10.1.0 --enable-checking=release --enable-languages=c,c++,fortran 
 --disable-multilib --program-suffix=-10.1</code></pre>

      <p>
        Теперь можно выполнять сборку GCC, лучше обычно дважды задать количство
        ядер процессора на компьютере, что бы ускорить сборку. У меня четыре
        ядра, так что я буду использовать 8 параллельных потоков для сборки GCC.
      </p>

      <pre><code class="language-shell">$ make -j 8</code></pre>

      <p>
        В зависимости от производительности компьютера, сборка может занять от
        30 минут до нескольких часов.
      </p>

      <p>
        Когда предидущий ээтап будет закончен можну выполнить установку GCC:
      </p>

      <pre><code class="language-shell">$ sudo make install-strip</code></pre>

      <p>
        Если вы хотите установить компиляторы перманентно в системную
        директорию, добавьте эти строки в конец файла .bashrc.
      </p>

      <pre><code class="language-shell">export PATH=/usr/local/gcc-10.1.0/bin:$PATH
export LD_LIBRARY_PATH=/usr/local/gcc-10.1.0/lib64:$LD_LIBRARY_PATH
# is it working? clangd still don't find proper inlude path until set new
# compiler in .clang config file
export CPLUS_INCLUDE_PATH=/usr/local/gcc-13.1.0/include:$CPLUS_INCLUDE_PATH
export C_INCLUDE_PATH=/usr/local/gcc-13.1.0/include:$C_INCLUDE_PATH</code></pre>

      <p>
        Вставьте в конец файла .bashrc строчки, упомянутые выше, сохраните файл
        и закройте редактор. Теперь, нужно скащать Bash перезагрузить .bashrc
        (это произойдёт автоматически, после перезагрузки компьютера):
      </p>

      <pre><code class="language-shell">.bashrc</code></pre>
    </div>
    <!-- ============= КОНЕЦ ЗАПИСИ ============== -->

    <div class="post">
      <!-- ============= НАЧАЛО ЗАПИСИ ============= -->

      <p><b>Настройка Manjaro (на примере 21.2.0)</b></p>

      <p>По умолчанию vmware linux tools установлены, можно проверить:</p>

      <pre><code class="language-shell">sudo pacman -Q | grep open-vm-tools</code></pre>

      <p>
        <b>Устанавливаем</b> основные зависимости (пакетный менеджер тут
        pacman):
      </p>

      <pre><code class="language-shell">$ sudo pacman -Syu git # если ещё не установлен
$ sudo pacman -Syu xed mc conky cmake
$ sudo pacman -Syu binutils make gcc pkg-config fakeroot</code></pre>

      <p>памятка по pacman:</p>

      <pre><code class="language-shell"># Синхронизовать локальную базу данных репозиториев и обновить все пакеты
$ sudo pacman -Syu {name}

# Установить новый пакет или обновить старый, 
# в manjaro "установка" равно "синхронизация"
$ sudo pacman -S {name}

# Удалить пакет не трогая зависимости
$ sudo pacman -R {name}

# Удалить пакет и его зависимости
$ sudo pacman -Rs {name}

# Поиск пакета в базе данных по регулярному выражению или ключевому слову
$ sudo pacman -Ss {search_pattern}

# Вывести список установленных пакетов и их версии
$ sudo pacman -Q 

# Вывести список явно установленных пакетов и их версии
$ sudo pacman -Qe 

# Определить, какому из пакетов принадлежит данный файл
$ sudo pacman -Qo

# Вывести список пакетов с доступными обновлениями
$ sudo pacman -Qu

# Очистить кеш пакетов для высвобождения дискового пространства
$ sudo pacman -Scc 

# Обновить кэш pacman. Проверит есть ли доступные обновления
$ sudo pacman -Syy</code></pre>

      <p>
        Для <b>устанавки</b> VSCode или любого другого пакета, который
        собирается из репозитория AUR (исходников) нужно что бы в системы были
        установлены зависимости для сборки -
        <i>binutils, make, gcc, pkg-config, fakeroot</i>, далее пакет
        выкачевается и собирается (на примере VSCode):
      </p>

      <pre><code class="language-shell">$ git clone https://aur.archlinux.org/visual-studio-code-bin.git
$ cd visual-studio-code-bin/
# Далее собираем, но по умолчанию makepkg использует
# один поток, можно подправить конфиг для исправления
$ xed /etc/makepkg.conf 
# Строка MAKEFLAGS="-j8"
$ makepkg -si
# Тут -s - Install missing dependencies using pacman
# -i - Install or upgrade the package after a successful build using pacman</code></pre>

      <p><b>Добавляем автозапуск</b> через gnome-tweaks:</p>

      <pre><code class="language-shell">$ gnome-tweaks</code></pre>
    </div>
    <!-- ============= КОНЕЦ ЗАПИСИ ============== -->

    <div class="post">
      <!-- ============= НАЧАЛО ЗАПИСИ ============= -->

      <p>
        <b>Как изменить shell?</b>
      </p>

      <pre><code class="language-bash">$ echo $SHELL # используемая оболочка
$ cat /etc/shells # доступные оболочки   
$ chsh -s {path} # например /bin/bash </code></pre>

      <p>
        PS1 - переменная в bashrc, которая отвечает за формат строки преглашения
        в шеле.
        <br />
        <b>\u и \h</b> - имя пользователя и хоста соответственно. Их можно
        сократить заменив на такие конструкции - ${USER:a:b}@${HOSTNAME:c:d},
        где a, b, c, d - стартовый сомвол и количество символов в оставшейся
        строке. <b>-w</b> - полный путь в приглашении (именно строчная w).
      </p>

      <pre><code class="language-bash"># алиас на ls для вывода всех файлов в список в алфавитном порядке
alias ls='ls --color=auto -l -A -X'</code></pre>
    </div>
    <!-- ============= КОНЕЦ ЗАПИСИ ============== -->

    <div class="post">
      <p>
        <b>Convert input.mp4 to output gif </b>with scale to 320p, and trim from
        0s to 10s
      </p>

      <pre><code class="language-bash">ffmpeg -t 00.00.10.000 -i input.mp4 -vf "fps=10,scale=320:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" -loop 0 output.gif</code></pre>
    </div>

    <div class="post">
      <p>
        <b>Change system languge in ubuntu 22.04</b>, useful for preserve
        difficulties with iteraction with command line apps (like vim etc.)
      </p>
      <p>/etc/default/locale - change to en_US</p>
    </div>

    <div class="post">
      <p>
        <b>Скачиваем файлы с youtube</b>
      </p>

      <pre><code class="language-bash"># в mp4 и качестве не выше 720p 
# и автоматическими субтитрами
yt-dlp -f "bestvideo[ext=mp4][height<=720]+bestaudio[ext=m4a]/best[ext=mp4]/best" --write-auto-sub --embed-subs URL</code></pre>
    </div>

    <div class="post">
      <p>
        <b>Remove Linux Mint grub settings (splashscreen, boot options order etc.)<br></b>
        For boot menu default option numeration see /boot/grub/grub.cfg, see "menuentry".
      </p>

      <pre><code class="language-bash">sudo nvim /etc/default/grub
# for disable splashscreen  
# set GRUB_CMDLINE_DEFAULT=""

# set default boot option
# GRUB_DEFAULT={x} where x - number
# start from zero

sudo update_grub
# also here you can set grub timeuot</code></pre>
    </div>

  </body>
</html>
